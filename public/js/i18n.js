const LANG = {
  en: {
    title: 'Claude Token Tracker',
    today: 'Today',
    days7: '7 Days',
    days30: '30 Days',
    allTime: 'All Time',
    live: 'Live',
    rebuildCache: 'Rebuild Cache',
    rebuilding: 'Rebuilding...',
    // Tabs
    overview: 'Overview',
    sessions: 'Sessions',
    projects: 'Projects',
    tools: 'Tools',
    models: 'Models',
    insights: 'Insights',
    info: 'Info',
    // KPI
    totalTokens: 'Total Tokens',
    estimatedCost: 'Estimated Cost',
    sessionsLabel: 'Sessions',
    messagesLabel: 'Messages',
    costSubLabel: 'API-equivalent estimate',
    uniqueSessions: 'Unique sessions',
    assistantResponses: 'Assistant responses',
    kpiTokensSub: (i, o, c) => `In: ${i} | Out: ${o} | Cache: ${c}`,
    kpiTokensSubNoCache: (i, o) => `In: ${i} | Out: ${o}`,
    cacheOn: 'Cache: On',
    cacheOff: 'Cache: Off',
    // Info tab
    infoTitle: 'How Token Tracking Works',
    infoInputTitle: 'Input Tokens',
    infoInputDesc: 'Tokens sent to the model in your prompt — your question, code context, system instructions, and conversation history. These are the tokens Claude reads to understand your request.',
    infoOutputTitle: 'Output Tokens',
    infoOutputDesc: 'Tokens generated by Claude in its response — code, explanations, tool calls. These are typically the most expensive tokens per unit.',
    infoCacheReadTitle: 'Cache Read Tokens',
    infoCacheReadDesc: 'Input tokens served from Anthropic\'s prompt cache instead of being reprocessed. When parts of your prompt (like system instructions or long context) repeat across requests, they can be cached. Cache reads are significantly cheaper than regular input tokens (~90% cheaper).',
    infoCacheCreateTitle: 'Cache Create Tokens',
    infoCacheCreateDesc: 'Tokens written to the prompt cache for the first time. This is a one-time cost per unique prompt prefix. Subsequent requests that share this prefix will benefit from cache read pricing. Cache create costs are similar to regular input pricing.',
    infoCostTitle: 'Cost Estimation',
    infoCostDesc: 'Costs shown are API-equivalent estimates based on official Anthropic pricing per model. Claude Code (Max plan) is billed as a flat subscription, not per token. These estimates show what your usage would cost at API rates — useful for understanding relative usage patterns and comparing efficiency.',
    infoDataSourceTitle: 'Data Source',
    infoDataSourceDesc: 'All data is parsed from Claude Code\'s JSONL session files stored locally at ~/.claude/projects/. No data is sent to any external service. The tracker reads these files, extracts token counts per message, and stores them in a local SQLite database for fast aggregation.',
    infoToggleTitle: 'Cache Toggle',
    infoToggleDesc: 'By default, cached tokens are hidden from statistics because they represent infrastructure overhead rather than actual content processed. Use the "Cache" toggle in the header to include them. When cache is included, you see the full picture; when excluded, you see only the tokens that directly contribute to your interactions.',
    infoPricingTitle: 'Model Pricing (per 1M tokens)',
    // Lines of code
    linesOfCode: 'Lines of Code',
    linesWritten: 'Write',
    linesEdited: 'Edit',
    linesDeleted: 'Delete',
    linesNet: 'Net Change',
    linesPerSession: 'per session',
    linesPerDay: 'per day',
    netChangeDesc: 'write + edit - delete',
    dailyLinesChart: 'Daily Lines of Code',
    tooltipLinesOfCode: 'Lines changed via Write (new files) and Edit (replacements/deletions) tool calls',
    tooltipDailyLines: 'Daily lines of code: green = Write, yellow = Edit, red = Delete',
    // Info section extras
    infoLinesTitle: 'Lines of Code',
    infoLinesDesc: 'The dashboard tracks three types of code line changes from Claude\'s tool calls: Write (green) counts lines from the Write tool when creating or overwriting files. Edit (yellow) counts lines from the Edit tool\'s replacement text. Delete (red) counts lines from the Edit tool\'s removed text. Net Change = write + edit - delete.',
    infoChartInteractivityTitle: 'Chart Interactivity',
    infoChartInteractivityDesc: 'Click any legend item to hide or show a dataset. Your legend selection is persisted in localStorage and restored on reload. The global period filter (Today / 7 Days / 30 Days / All Time) is also persisted across sessions.',
    infoDashboardOverviewTitle: 'Dashboard Overview',
    infoDashboardOverviewDesc: 'Overview: KPI cards, daily token usage, cost trend, model distribution, hourly activity. Sessions: sortable table of all sessions with tokens, lines, and cost. Projects: per-project breakdown with bar chart. Tools: tool call frequency chart and table. Models: model usage over time (area chart) and table. Insights: cost breakdown, cumulative cost, weekday activity, cache efficiency, stop reasons, session efficiency scatter, and daily lines chart. Info: documentation, sync agent setup (multi-user), and model pricing.',
    // Charts
    dailyTokenUsage: 'Daily Token Usage',
    dailyCostTrend: 'Daily Cost Trend',
    modelDistribution: 'Model Distribution',
    activityByHour: 'Activity by Hour',
    tokensByProject: 'Tokens by Project',
    toolUsage: 'Tool Usage',
    modelUsageOverTime: 'Model Usage Over Time',
    // Insights
    costBreakdown: 'Cost Breakdown',
    cumulativeCost: 'Cumulative Cost',
    weekdayActivity: 'Weekday Activity',
    cacheEfficiency: 'Cache Efficiency',
    stopReasons: 'Stop Reasons',
    sessionEfficiency: 'Session Efficiency',
    // Table headers
    date: 'Date',
    project: 'Project',
    model: 'Model',
    duration: 'Duration',
    messages: 'Messages',
    toolCalls: 'Tools',
    tokens: 'Tokens',
    cost: 'Cost',
    totalTokensH: 'Total Tokens',
    input: 'Input',
    output: 'Output',
    cacheRead: 'Cache Read',
    cacheCreate: 'Cache Create',
    calls: 'Calls',
    pctTotal: '% of Total',
    tool: 'Tool',
    allProjects: 'All Projects',
    // Chart legends
    inputLabel: 'Input',
    outputLabel: 'Output',
    cacheReadLabel: 'Cache Read',
    cacheCreateLabel: 'Cache Create',
    apiEquivCost: 'API-equivalent Cost',
    // Stats-cache
    officialStats: 'Claude Stats (All Time)',
    parsedFromFiles: 'from session files on disk',
    totalMsgsOfficial: 'official total',
    // Data source
    dataSource: 'Source: JSONL session files',
    // Tooltips
    tooltipTotalTokens: 'Sum of input, output, cache-read, and cache-create tokens for the selected period',
    tooltipEstimatedCost: 'Cost estimate based on official API pricing per model — not actual billing',
    tooltipSessions: 'Number of unique Claude Code sessions (each CLI invocation = 1 session)',
    tooltipMessages: 'Number of assistant responses (API round-trips)',
    tooltipDailyTokens: 'Stacked bar chart showing token consumption by type per day',
    tooltipDailyCost: 'API-equivalent cost trend over time',
    tooltipModelDist: 'Token share per Claude model (Opus, Sonnet, Haiku)',
    tooltipHourly: 'When are you most active? Messages grouped by hour of day',
    tooltipCostBreakdown: 'Cost split by token type: input, output, cache-read, cache-create',
    tooltipCumulativeCost: 'Running total of estimated costs over time',
    tooltipWeekday: 'Messages and costs grouped by day of week',
    tooltipCacheEfficiency: 'Daily cache hit rate: cache-read / (input + cache-read + cache-create)',
    tooltipStopReasons: 'Why did the model stop? end_turn = natural, tool_use = called a tool',
    tooltipSessionEfficiency: 'Tokens per message vs. cost per message — lower-left is most efficient',
    tooltipInputTokens: 'Tokens sent to the model — your prompt, code context, and conversation history',
    tooltipOutputTokens: 'Tokens generated by Claude — code, explanations, tool calls',
    tooltipCacheReadTokens: 'Input tokens served from prompt cache (~90% cheaper than regular input)',
    tooltipCacheCreateTokens: 'Tokens written to prompt cache for the first time',
    // Auth & Multi-user
    loginDesc: 'Sign in to view your token usage.',
    loginWithGithub: 'Sign in with GitHub',
    logout: 'Sign out',
    // Sync setup
    activeSessions: 'Active Sessions',
    syncSetupTitle: 'Sync Agent Setup',
    syncSetupDesc: 'Install the sync agent on your machine to automatically upload token data to this server. The agent watches your local Claude session files and sends new data via API.',
    apiKey: 'API Key',
    copy: 'Copy',
    regenerate: 'Regenerate',
    syncInstallTitle: 'Installation',
    syncInstallDesc: 'Copy the command below and run it in your terminal \u2014 the agent installs, connects, and sets up autostart automatically.',
    syncCurlLabel: 'Install command',
    syncOrDownload: 'Or download as file:',
    syncDownloadBtn: 'Download install script',
    syncPm2Title: 'Autostart',
    syncAutostartDesc: 'The script automatically sets up autostart (launchd on macOS, systemd on Linux). If you prefer PM2:',
    copied: 'Copied!',
  },
  de: {
    title: 'Claude Token Tracker',
    today: 'Heute',
    days7: '7 Tage',
    days30: '30 Tage',
    allTime: 'Gesamt',
    live: 'Live',
    rebuildCache: 'Cache neu aufbauen',
    rebuilding: 'Wird aufgebaut...',
    // Tabs
    overview: 'Übersicht',
    sessions: 'Sitzungen',
    projects: 'Projekte',
    tools: 'Tools',
    models: 'Modelle',
    insights: 'Insights',
    info: 'Info',
    // KPI
    totalTokens: 'Tokens gesamt',
    estimatedCost: 'Geschätzte Kosten',
    sessionsLabel: 'Sitzungen',
    messagesLabel: 'Nachrichten',
    costSubLabel: 'API-äquivalente Schätzung',
    uniqueSessions: 'Einzigartige Sitzungen',
    assistantResponses: 'Assistenten-Antworten',
    kpiTokensSub: (i, o, c) => `In: ${i} | Out: ${o} | Cache: ${c}`,
    kpiTokensSubNoCache: (i, o) => `In: ${i} | Out: ${o}`,
    cacheOn: 'Cache: An',
    cacheOff: 'Cache: Aus',
    // Info tab
    infoTitle: 'So funktioniert das Token-Tracking',
    infoInputTitle: 'Input Tokens',
    infoInputDesc: 'Tokens, die an das Modell gesendet werden — deine Frage, Code-Kontext, Systemanweisungen und Gesprächsverlauf. Diese Tokens liest Claude, um deine Anfrage zu verstehen.',
    infoOutputTitle: 'Output Tokens',
    infoOutputDesc: 'Tokens, die Claude in seiner Antwort generiert — Code, Erklärungen, Tool-Aufrufe. Diese sind pro Einheit in der Regel die teuersten Tokens.',
    infoCacheReadTitle: 'Cache Read Tokens',
    infoCacheReadDesc: 'Input-Tokens, die aus Anthropics Prompt-Cache gelesen werden, anstatt neu verarbeitet zu werden. Wenn Teile deines Prompts (wie Systemanweisungen oder langer Kontext) sich über Anfragen wiederholen, können sie gecacht werden. Cache-Reads sind deutlich günstiger als reguläre Input-Tokens (~90% günstiger).',
    infoCacheCreateTitle: 'Cache Create Tokens',
    infoCacheCreateDesc: 'Tokens, die erstmalig in den Prompt-Cache geschrieben werden. Dies ist ein einmaliger Aufwand pro eindeutigem Prompt-Präfix. Folgende Anfragen mit gleichem Präfix profitieren dann vom Cache-Read-Preis. Cache-Create-Kosten sind ähnlich wie reguläre Input-Kosten.',
    infoCostTitle: 'Kostenschätzung',
    infoCostDesc: 'Die angezeigten Kosten sind API-äquivalente Schätzungen basierend auf offiziellen Anthropic-Preisen pro Modell. Claude Code (Max-Plan) wird als Flatrate-Abonnement abgerechnet, nicht pro Token. Diese Schätzungen zeigen, was deine Nutzung zu API-Preisen kosten würde — nützlich zum Verständnis relativer Nutzungsmuster.',
    infoDataSourceTitle: 'Datenquelle',
    infoDataSourceDesc: 'Alle Daten werden aus den lokalen JSONL-Sitzungsdateien von Claude Code unter ~/.claude/projects/ gelesen. Es werden keine Daten an externe Dienste gesendet. Der Tracker liest diese Dateien, extrahiert Token-Zähler pro Nachricht und speichert sie in einer lokalen SQLite-Datenbank.',
    infoToggleTitle: 'Cache-Umschalter',
    infoToggleDesc: 'Standardmäßig werden gecachte Tokens in den Statistiken ausgeblendet, da sie Infrastruktur-Overhead darstellen und nicht tatsächlich verarbeiteten Inhalt. Nutze den "Cache"-Schalter im Header, um sie einzubeziehen. Mit Cache siehst du das vollständige Bild; ohne Cache nur die Tokens, die direkt zu deinen Interaktionen beitragen.',
    infoPricingTitle: 'Modell-Preise (pro 1M Tokens)',
    // Lines of code
    linesOfCode: 'Zeilen Code',
    linesWritten: 'Write',
    linesEdited: 'Edit',
    linesDeleted: 'Delete',
    linesNet: 'Netto-Änderung',
    linesPerSession: 'pro Sitzung',
    linesPerDay: 'pro Tag',
    netChangeDesc: 'write + edit - delete',
    dailyLinesChart: 'Tägliche Zeilen Code',
    tooltipLinesOfCode: 'Geänderte Zeilen via Write (neue Dateien) und Edit (Ersetzungen/Löschungen) Tool-Aufrufe',
    tooltipDailyLines: 'Tägliche Codezeilen: grün = Write, gelb = Edit, rot = Delete',
    // Info section extras
    infoLinesTitle: 'Lines of Code',
    infoLinesDesc: 'Das Dashboard erfasst drei Arten von Codezeilen-Änderungen aus Claudes Tool-Aufrufen: Write (grün) zählt Zeilen vom Write-Tool beim Erstellen oder Überschreiben von Dateien. Edit (gelb) zählt Zeilen aus dem Ersetzungstext des Edit-Tools. Delete (rot) zählt Zeilen aus dem entfernten Text des Edit-Tools. Netto-Änderung = write + edit - delete.',
    infoChartInteractivityTitle: 'Chart-Interaktivität',
    infoChartInteractivityDesc: 'Klicke auf ein Legenden-Element, um einen Datensatz ein- oder auszublenden. Deine Legendenauswahl wird im localStorage gespeichert und beim Neuladen wiederhergestellt. Der globale Zeitraumfilter (Heute / 7 Tage / 30 Tage / Gesamt) wird ebenfalls über Sitzungen hinweg gespeichert.',
    infoDashboardOverviewTitle: 'Dashboard-Übersicht',
    infoDashboardOverviewDesc: 'Übersicht: KPI-Cards, täglicher Token-Verbrauch, Kosten-Trend, Modell-Verteilung, stündliche Aktivität. Sitzungen: sortierbare Tabelle aller Sitzungen mit Tokens, Zeilen und Kosten. Projekte: Aufschlüsselung pro Projekt mit Balkendiagramm. Tools: Tool-Aufrufhäufigkeit als Diagramm und Tabelle. Modelle: Modellnutzung im Zeitverlauf (Flächendiagramm) und Tabelle. Insights: Kostenaufschlüsselung, kumulative Kosten, Wochentags-Aktivität, Cache-Effizienz, Stop-Reasons, Session-Effizienz-Streudiagramm und tägliche Codezeilen. Info: Dokumentation, Sync-Agent-Einrichtung (Multi-User) und Modellpreise.',
    // Charts
    dailyTokenUsage: 'Täglicher Token-Verbrauch',
    dailyCostTrend: 'Täglicher Kosten-Trend',
    modelDistribution: 'Modell-Verteilung',
    activityByHour: 'Aktivität nach Uhrzeit',
    tokensByProject: 'Tokens nach Projekt',
    toolUsage: 'Tool-Nutzung',
    modelUsageOverTime: 'Modell-Nutzung im Zeitverlauf',
    // Insights
    costBreakdown: 'Kostenaufschlüsselung',
    cumulativeCost: 'Kumulative Kosten',
    weekdayActivity: 'Wochentags-Aktivität',
    cacheEfficiency: 'Cache-Effizienz',
    stopReasons: 'Stop Reasons',
    sessionEfficiency: 'Session-Effizienz',
    // Table headers
    date: 'Datum',
    project: 'Projekt',
    model: 'Modell',
    duration: 'Dauer',
    messages: 'Nachrichten',
    toolCalls: 'Tools',
    tokens: 'Tokens',
    cost: 'Kosten',
    totalTokensH: 'Tokens gesamt',
    input: 'Input',
    output: 'Output',
    cacheRead: 'Cache Read',
    cacheCreate: 'Cache Create',
    calls: 'Aufrufe',
    pctTotal: '% gesamt',
    tool: 'Tool',
    allProjects: 'Alle Projekte',
    // Chart legends
    inputLabel: 'Input',
    outputLabel: 'Output',
    cacheReadLabel: 'Cache Read',
    cacheCreateLabel: 'Cache Create',
    apiEquivCost: 'API-äquivalente Kosten',
    // Stats-cache
    officialStats: 'Claude Stats (gesamt)',
    parsedFromFiles: 'aus Sitzungsdateien auf Disk',
    totalMsgsOfficial: 'offizielle Gesamtzahl',
    // Data source
    dataSource: 'Quelle: JSONL-Sitzungsdateien',
    // Tooltips
    tooltipTotalTokens: 'Summe aus Input-, Output-, Cache-Read- und Cache-Create-Tokens im gewählten Zeitraum',
    tooltipEstimatedCost: 'Kostenschätzung basierend auf offiziellen API-Preisen pro Modell — keine echte Abrechnung',
    tooltipSessions: 'Anzahl einzigartiger Claude-Code-Sitzungen (jeder CLI-Aufruf = 1 Sitzung)',
    tooltipMessages: 'Anzahl der Assistenten-Antworten (API-Roundtrips)',
    tooltipDailyTokens: 'Gestapeltes Balkendiagramm: Token-Verbrauch nach Typ pro Tag',
    tooltipDailyCost: 'API-äquivalenter Kostentrend über die Zeit',
    tooltipModelDist: 'Token-Anteil pro Claude-Modell (Opus, Sonnet, Haiku)',
    tooltipHourly: 'Wann bist du am aktivsten? Nachrichten gruppiert nach Tageszeit',
    tooltipCostBreakdown: 'Kosten aufgeteilt nach Token-Typ: Input, Output, Cache-Read, Cache-Create',
    tooltipCumulativeCost: 'Laufende Gesamtkosten über die Zeit',
    tooltipWeekday: 'Nachrichten und Kosten gruppiert nach Wochentag',
    tooltipCacheEfficiency: 'Tägliche Cache-Hit-Rate: Cache-Read / (Input + Cache-Read + Cache-Create)',
    tooltipStopReasons: 'Warum hat das Modell gestoppt? end_turn = natürlich, tool_use = Tool aufgerufen',
    tooltipSessionEfficiency: 'Tokens pro Nachricht vs. Kosten pro Nachricht — unten links ist am effizientesten',
    tooltipInputTokens: 'Tokens, die an das Modell gesendet werden — Prompt, Code-Kontext und Gesprächsverlauf',
    tooltipOutputTokens: 'Von Claude generierte Tokens — Code, Erklärungen, Tool-Aufrufe',
    tooltipCacheReadTokens: 'Input-Tokens aus dem Prompt-Cache (~90% günstiger als regulärer Input)',
    tooltipCacheCreateTokens: 'Tokens, die erstmalig in den Prompt-Cache geschrieben werden',
    // Auth & Multi-user
    loginDesc: 'Melde dich an, um deine Token-Nutzung zu sehen.',
    loginWithGithub: 'Mit GitHub anmelden',
    logout: 'Abmelden',
    // Sync setup
    activeSessions: 'Aktive Sitzungen',
    syncSetupTitle: 'Sync Agent einrichten',
    syncSetupDesc: 'Installiere den Sync-Agent auf deinem Rechner, um Token-Daten automatisch an diesen Server zu übertragen. Der Agent überwacht deine lokalen Claude-Sitzungsdateien und sendet neue Daten per API.',
    apiKey: 'API-Key',
    copy: 'Kopieren',
    regenerate: 'Neu generieren',
    syncInstallTitle: 'Installation',
    syncInstallDesc: 'Kopiere den Befehl unten und f\u00fchre ihn im Terminal aus \u2014 der Agent installiert sich, verbindet sich und richtet den Autostart automatisch ein.',
    syncCurlLabel: 'Installations-Befehl',
    syncOrDownload: 'Oder als Datei herunterladen:',
    syncDownloadBtn: 'Install-Script herunterladen',
    syncPm2Title: 'Autostart',
    syncAutostartDesc: 'Das Script richtet automatisch einen Autostart ein (launchd auf macOS, systemd auf Linux). Falls du PM2 bevorzugst:',
    copied: 'Kopiert!',
  }
};

let currentLang = localStorage.getItem('lang') || 'de';

function t(key) {
  return LANG[currentLang][key] || LANG.en[key] || key;
}

function setLang(lang) {
  currentLang = lang;
  localStorage.setItem('lang', lang);
  applyTranslations();
}

function applyTranslations() {
  // Update all elements with data-i18n attribute
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  // Update lang buttons
  document.querySelectorAll('.lang-btn').forEach(b => {
    b.classList.toggle('active', b.dataset.lang === currentLang);
  });
}
